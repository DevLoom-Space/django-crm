{% extends "base.html" %}
{% block title %}{{ deal.title }} | CRM{% endblock %}

{% block page_header %}
  <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
    <div>
      <h1 class="h3 mb-1">{{ deal.title }}</h1>
      <div class="text-muted small">
        <span class="me-2">
          <i class="bi bi-building me-1"></i>
          <a class="text-decoration-none" href="{% url 'company_detail' deal.company.pk %}">{{ deal.company.name }}</a>
        </span>
        <span class="badge bg-primary-subtle text-primary badge-stage">{{ deal.get_stage_display }}</span>
      </div>
    </div>

    <div class="d-flex gap-2">
      <a class="btn btn-outline-secondary btn-sm" href="{% url 'deal_update' deal.pk %}">
        <i class="bi bi-pencil me-1"></i> Edit
      </a>
      <a class="btn btn-outline-danger btn-sm" href="{% url 'deal_delete' deal.pk %}">
        <i class="bi bi-trash me-1"></i> Delete
      </a>
      <a class="btn btn-primary btn-sm" href="{% url 'deal_list' %}">
        <i class="bi bi-arrow-left me-1"></i> Back
      </a>
    </div>
  </div>
{% endblock %}

{% block content %}
  <div class="row g-3">
    <div class="col-12 col-lg-8">
      <div class="card shadow-soft">
        <div class="card-body">

          <div class="row g-3">
            <div class="col-12 col-md-6">
              <div class="text-muted small">Contact</div>
              <div class="fw-semibold">
                {% if deal.contact %}
                  <a class="text-decoration-none" href="{% url 'contact_detail' deal.contact.pk %}">
                    {{ deal.contact.first_name }} {{ deal.contact.last_name }}
                  </a>
                {% else %}
                  —
                {% endif %}
              </div>
            </div>

            <div class="col-12 col-md-6">
              <div class="text-muted small">Owner</div>
              <div class="fw-semibold">{{ deal.owner.username|default:"—" }}</div>
            </div>

            <div class="col-12 col-md-6">
              <div class="text-muted small">Amount</div>
              <div class="fw-semibold">{{ deal.amount }}</div>
            </div>

            <div class="col-12 col-md-6">
              <div class="text-muted small">Expected Close Date</div>
              <div class="fw-semibold">{{ deal.expected_close_date|default:"—" }}</div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <div class="col-12 col-lg-4">
      <div class="card shadow-soft">
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <h2 class="h6 mb-0">Quick actions</h2>
          </div>

          <div class="d-grid gap-2">
            <a class="btn btn-primary btn-sm" href="{% url 'activity_create' %}">
              <i class="bi bi-plus-circle me-1"></i> Add Activity
            </a>
            <a class="btn btn-outline-primary btn-sm" href="{% url 'note_create' %}">
              <i class="bi bi-plus-circle me-1"></i> Add Note
            </a>
          </div>

          <div class="text-muted small mt-3">
            Tip: link activities/notes to this deal for clean tracking.
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
